{% extends "common/base.html" %}

{% block title %}API Key Created - SAJHA MCP Server{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Success Message -->
            <div class="card border-success mb-4">
                <div class="card-header bg-success text-white">
                    <i class="bi bi-check-circle me-2"></i>API Key Created Successfully
                </div>
                <div class="card-body text-center py-4">
                    <i class="bi bi-key text-success" style="font-size: 4rem;"></i>
                    <h3 class="mt-3">{{ apikey.name }}</h3>
                    <p class="text-muted">{{ message }}</p>
                </div>
            </div>

            <!-- Important Warning -->
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <strong>Important:</strong> This is the only time you will see the full API key. 
                Please copy it now and store it securely. You will not be able to retrieve it again.
            </div>

            <!-- API Key Display -->
            <div class="card mb-4">
                <div class="card-header bg-dark text-white">
                    <i class="bi bi-key me-2"></i>Your API Key
                </div>
                <div class="card-body">
                    <div class="input-group">
                        <input type="text" class="form-control font-monospace bg-light" id="apiKeyValue" 
                               value="{{ apikey.key }}" readonly>
                        <button class="btn btn-primary" type="button" onclick="copyKey()">
                            <i class="bi bi-clipboard me-1"></i> Copy
                        </button>
                    </div>
                    <div id="copyFeedback" class="text-success mt-2" style="display: none;">
                        <i class="bi bi-check-circle me-1"></i> Copied to clipboard!
                    </div>
                </div>
            </div>

            <!-- Key Details -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <i class="bi bi-info-circle me-2"></i>Key Details
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Name</dt>
                        <dd class="col-sm-8">{{ apikey.name }}</dd>
                        
                        {% if apikey.description %}
                        <dt class="col-sm-4">Description</dt>
                        <dd class="col-sm-8">{{ apikey.description }}</dd>
                        {% endif %}
                        
                        <dt class="col-sm-4">Access Mode</dt>
                        <dd class="col-sm-8">
                            {% if apikey.tool_access.mode == 'all' %}
                            <span class="badge bg-success">All Tools</span>
                            {% elif apikey.tool_access.mode == 'allowlist' %}
                            <span class="badge bg-info">Allowlist ({{ apikey.tool_access.tools|length }} tools)</span>
                            {% elif apikey.tool_access.mode == 'denylist' %}
                            <span class="badge bg-warning text-dark">Denylist ({{ apikey.tool_access.tools|length }} tools)</span>
                            {% elif apikey.tool_access.mode == 'regex' %}
                            <span class="badge bg-secondary">Regex ({{ apikey.tool_access.regex_patterns|length }} patterns)</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-4">Rate Limit</dt>
                        <dd class="col-sm-8">{{ apikey.rate_limit.requests_per_minute }} req/min, {{ apikey.rate_limit.requests_per_hour }} req/hour</dd>
                        
                        <dt class="col-sm-4">Status</dt>
                        <dd class="col-sm-8">
                            <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Enabled</span>
                        </dd>
                        
                        {% if apikey.expires_at %}
                        <dt class="col-sm-4">Expires</dt>
                        <dd class="col-sm-8">{{ apikey.expires_at[:10] }}</dd>
                        {% endif %}
                    </dl>
                </div>
            </div>

            <!-- Usage Example -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <i class="bi bi-code-square me-2"></i>Usage Example
                </div>
                <div class="card-body">
                    <pre class="bg-dark text-light p-3 rounded mb-0"><code># Using curl with X-API-Key header:
curl -H "X-API-Key: {{ apikey.key }}" \
     http://localhost:3002/api/tools

# Or using Authorization header:
curl -H "Authorization: {{ apikey.key }}" \
     http://localhost:3002/api/tools

# Python example:
import requests
headers = {"X-API-Key": "{{ apikey.key }}"}
response = requests.get("http://localhost:3002/api/tools", headers=headers)</code></pre>
                </div>
            </div>

            <!-- Actions -->
            <div class="d-flex justify-content-between">
                <a href="{{ url_for('admin_apikeys') }}" class="btn btn-primary">
                    <i class="bi bi-list me-1"></i> Back to API Keys List
                </a>
                <a href="{{ url_for('admin_apikeys_create') }}" class="btn btn-success">
                    <i class="bi bi-plus-circle me-1"></i> Create Another Key
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function copyKey() {
    const keyInput = document.getElementById('apiKeyValue');
    keyInput.select();
    keyInput.setSelectionRange(0, 99999);
    
    navigator.clipboard.writeText(keyInput.value).then(function() {
        const feedback = document.getElementById('copyFeedback');
        feedback.style.display = 'block';
        setTimeout(function() {
            feedback.style.display = 'none';
        }, 3000);
    });
}
</script>
{% endblock %}

{% block page_glossary %}
<div class="container-fluid mt-4">
    <div class="card border-secondary">
        <div class="card-header bg-secondary text-white" data-bs-toggle="collapse" data-bs-target="#pageGlossary" style="cursor: pointer;">
            <i class="bi bi-book me-2"></i>Page Glossary
            <i class="bi bi-chevron-down float-end"></i>
        </div>
        <div class="collapse" id="pageGlossary">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>API Key:</strong> A unique identifier for authenticating programmatic API requests.</p>
                        <p><strong>Rate Limit:</strong> Maximum number of requests allowed per time period.</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Tool Access:</strong> Which tools an API key is authorized to use.</p>
                        <p><strong>X-API-Key Header:</strong> HTTP header used to pass the API key in requests.</p>
                    </div>
                </div>
                <div class="text-end mt-2">
                    <a href="{{ url_for('docs_view', doc_path='architecture/Glossary.md') }}" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-book me-1"></i>View Full Glossary
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
